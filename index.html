<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TuaPay Interactive Flow</title>
<style>
  :root{
    --bg:#ffffff;
    --grid:#eff3f8;
    --text:#1f2d3d;
    --muted:#5a6b7b;

    /* universal node colors */
    --call-fill:#cddd72;         /* lime */
    --call-border:#a5c15c;
    --decision-fill:#ff7c33;     /* orange */
    --decision-border:#e86d27;

    --shadow:0 6px 18px rgba(20,40,80,0.12);
    --radius:10px;
  }
  html,body{margin:0;background:var(--bg);color:var(--text);font:14px/1.35 Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{display:flex;flex-direction:column;gap:18px;padding:22px}
  header{display:flex;align-items:center;justify-content:space-between}
  h1{font-size:22px;margin:0;color:#085588}
  .legend{display:flex;gap:14px;align-items:center;color:var(--muted);font-size:12px}
  .legend .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;background:#fff;border-radius:999px;box-shadow:var(--shadow);border:1px solid #e7eef7}
  .chip .sw{width:14px;height:14px;border-radius:3px}
  .chip.email .sw{background:linear-gradient(180deg,#fff,#f7fdff);border:1px solid #ccc}
  .chip.call .sw{background:var(--call-fill);border:1px solid var(--call-border)}
  .chip.decision .sw{background:var(--decision-fill);border:1px solid var(--decision-border);transform:rotate(45deg);border-radius:2px}

  .controls{display:flex;flex-wrap:wrap;gap:8px;margin:4px 0 2px}
  .controls a{font-size:12px;color:#085588;text-decoration:none;background:#eef5ff;border:1px solid #d6e5ff;padding:6px 10px;border-radius:999px}
  .hint{color:#6a7b8c;font-size:12px}

  .board{position:relative;overflow:auto;border-radius:12px;background:#fff;border:1px solid #dfe7f1;box-shadow:var(--shadow)}
  .lane-title{font-weight:700;fill:#085588}

  /* Modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(9,16,28,0.45);z-index:9999}
  .modal.show{display:flex}
  .card{width:min(860px,92vw);max-height:86vh;overflow:auto;background:#fff;border-radius:14px;box-shadow:0 20px 60px rgba(0,0,0,0.25);padding:22px 24px;border:2px solid #eaf1fb}
  .card h2{margin:0 0 8px;font-size:20px}
  .meta{display:flex;flex-wrap:wrap;gap:10px;margin:8px 0 14px;color:#4b5b6a;font-size:12px}
  .meta .pill{background:#f2f7ff;color:#085588;border:1px solid #dbe6ff;padding:6px 10px;border-radius:999px}
  .kv{display:grid;grid-template-columns:160px 1fr;gap:8px 16px;margin-top:8px}
  .kv .k{color:#74879a;text-transform:uppercase;letter-spacing:.04em;font-size:11px}
  .kv .v{color:#263445}
  .assets{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .assets a{text-decoration:none;color:#085588;background:#edf3ff;border:1px solid #d6e3ff;padding:6px 10px;border-radius:8px}
  .close{position:sticky;top:0;float:right;transform:translateY(-6px);background:#085588;color:#fff;border:none;padding:8px 12px;border-radius:999px;cursor:pointer}
  .note{margin-top:10px;color:#445468;background:#f9fbff;border:1px dashed #d2def2;padding:10px 12px;border-radius:8px}

  .node-title{font-weight:600;font-size:12px}
  .node-sub{fill:#5a6b7b;font-size:11px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>TuaPay Onboarding & Advocacy Flow</h1>
    <div class="legend">
      <span class="chip email"><span class="sw"></span>Email</span>
      <span class="chip call"><span class="sw"></span>MS Call</span>
      <span class="chip decision"><span class="sw"></span>Decision / Branch</span>
    </div>
  </header>
  <div class="controls">
    <a href="#phase1">Phase 1 – New Merchant</a>
    <a href="#phase2">Phase 2 – Advocacy</a>
    <a href="#high">High Usage</a>
    <a href="#low">Low Usage</a>
    <a href="#newstaff">New Staff</a>
  </div>
  <div class="hint">Wide scroll enabled — click any box for details (links are placeholders for now).</div>

  <div class="board">
    <svg id="flow" width="3600" height="920" viewBox="0 0 3600 920" xmlns="http://www.w3.org/2000/svg" aria-label="TuaPay Interactive Flowchart">
      <defs>
        <marker id="arrow" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L12,4 L0,8 Z" fill="#98a9bc"></path>
        </marker>
      </defs>
      <g id="lanes"></g>
      <g id="connectors" stroke="#98a9bc" stroke-width="2" fill="none" marker-end="url(#arrow)"></g>
      <g id="nodes"></g>
    </svg>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="card" role="document">
    <button class="close" id="closeBtn" aria-label="Close">Close ✕</button>
    <h2 id="m_title">Title</h2>
    <div class="meta" id="m_meta"></div>
    <div class="kv">
      <div class="k">Trigger</div><div class="v" id="m_trigger"></div>
      <div class="k">Audience</div><div class="v" id="m_audience"></div>
      <div class="k">Summary</div><div class="v" id="m_summary"></div>
    </div>
    <div class="assets" id="m_assets"></div>
    <div class="note" id="m_notes"></div>
  </div>
</div>

<script>
/* ======= PER-LANE EMAIL ACCENT COLORS ======= */
const emailAccents = {
  "phase1":"#47b7c9",  // teal
  "phase2":"#085588",  // navy
  "high":"#cb6ce6",    // purple
  "low":"#ffde59",     // yellow
  "newstaff":"#38b6ff" // blue
};

/* ======= DATA (trimmed summaries; placeholder links) ======= */
const DATA = {
  lanes: [
    { id:"phase1", y:90,  title:"PHASE 1 – New Merchant Onboarding (Goal: First Transaction)" },
    { id:"phase2", y:300, title:"PHASE 2 – Advocacy Onboarding (Goal: Star Merchant Behaviours)" },
    { id:"high",   y:520, title:"HIGH USAGE – Star Merchant Path" },
    { id:"low",    y:660, title:"LOW USAGE – Re-activation Path" },
    { id:"newstaff", y:800, title:"NEW STAFF – Re-training Path" }
  ],
  nodes: [
    // ---------------- PHASE 1 ----------------
    { id:"p1_start", lane:"phase1", x:60, type:"decision",
      title:"Start: Sales → Merchant Success Handoff", sub:"HubSpot: Live – Onboarding",
      details:{ day:"Day 0", trigger:"Deal → “Live – Onboarding”.", audience:"—",
        summary:"Entry into Phase 1.", assets:[], notes:"Proceed to Phase 1 email sequence." } },

    { id:"p1_e1", lane:"phase1", x:320, type:"email",
      title:"Welcome to TuaPay", sub:"Email • Day 0",
      details:{ day:"Day 0", trigger:"Start reached", audience:"Primary contact",
        summary:"Welcome, benefits, portal login, 30‑day plan.", assets:pl(['Portal login','Quick Start Guide','Contact: Heidi']),
        notes:"CS: Call if unopened after 2 days." } },

    { id:"p1_e2", lane:"phase1", x:640, type:"email",
      title:"Your Portal & Pre‑Qual Link", sub:"Email • +3 days",
      details:{ day:"+3", trigger:"Phase 1 cadence", audience:"Front desk / office mgr",
        summary:"Portal basics & pre‑qual share; try a quick test.", assets:pl(['Portal Guide','QR signage','QR landing page']),
        notes:"CS: Follow up if unopened." } },

    { id:"p1_e3", lane:"phase1", x:960, type:"email",
      title:"Marketing Materials to Get You Started", sub:"Email • +4 days",
      details:{ day:"+4", trigger:"Phase 1 cadence", audience:"Front desk / marketing",
        summary:"Ready‑made materials for practice & online.", assets:pl(['Canva flyer','Social templates','Client email template']),
        notes:"CS: Offer customization help." } },

    { id:"p1_call1", lane:"phase1", x:1280, type:"call",
      title:"MS Call 1", sub:"Call • +4 days",
      details:{ day:"+4", trigger:"Phase 1 cadence", audience:"Primary contact",
        summary:"Check access; remove early barriers; push first transaction.", assets:[],
        notes:"Purpose: ensure readiness for first loan." } },

    { id:"p1_e4", lane:"phase1", x:1600, type:"email",
      title:"Try a Test Invoice", sub:"Email • +4 days",
      details:{ day:"+4", trigger:"Phase 1 cadence", audience:"Front desk / office mgr",
        summary:"How to submit a test invoice; practice before live.", assets:pl(['Test invoice guide','Walkthrough video']),
        notes:"CS: Monitor for test activity." } },

    { id:"p1_e5", lane:"phase1", x:1920, type:"email",
      title:"Tips for Approvals", sub:"Email • +4 days",
      details:{ day:"+4", trigger:"Phase 1 cadence", audience:"Primary contact",
        summary:"Best practices to lift approval rates.", assets:pl(['Approval tips PDF']),
        notes:"CS: Review applications if any." } },

    { id:"p1_e6", lane:"phase1", x:2240, type:"email",
      title:"Help Your Clients Say Yes", sub:"Email • +4 days",
      details:{ day:"+4", trigger:"Phase 1 cadence", audience:"Primary contact",
        summary:"Positioning scripts & role‑play.", assets:pl(['Conversation script']),
        notes:"CS: Offer role‑play." } },

    { id:"p1_call2", lane:"phase1", x:2560, type:"call",
      title:"MS Call 2 – Final 30‑Day Check‑In", sub:"Call • +3 days",
      details:{ day:"+3", trigger:"Phase 1 cadence", audience:"Primary contact",
        summary:"Ensure first loan; address blockers; choose next step.", assets:[],
        notes:"Purpose: confirm success or route to Sales." } },

    { id:"p1_decision1", lane:"phase1", x:2880, type:"decision",
      title:"Decision: First funded loan?", sub:"Branch",
      details:{ day:"—", trigger:"Funded loan within ~30 days?", audience:"—",
        summary:"Yes → Phase 2. No by Day 30 → Sales.", assets:[], notes:"Monitored in HubSpot." } },

    // ---------------- PHASE 2 ----------------
    { id:"p2_e1", lane:"phase2", x:320, type:"email",
      title:"Congrats on Your First Loan", sub:"Email • Day 0",
      details:{ day:"Day 0", trigger:"First funded loan", audience:"Primary contact",
        summary:"Celebrate; outline steady‑use benefits; set advocacy goals.", assets:pl(['Advocacy checklist']),
        notes:"CS: Optional congrats call." } },

    { id:"p2_e2", lane:"phase2", x:640, type:"email",
      title:"Promote TuaPay to Your Clients", sub:"Email • +5 days",
      details:{ day:"+5", trigger:"Phase 2 cadence", audience:"Front desk / marketing",
        summary:"Using marketing materials; link to resources.", assets:pl(['Canva templates','Flyer PDF']),
        notes:"" } },

    { id:"p2_call1", lane:"phase2", x:960, type:"call",
      title:"MS Call – Early Usage Check", sub:"Call • +5 days",
      details:{ day:"+5", trigger:"Phase 2 cadence", audience:"Primary contact",
        summary:"Review early transactions; encourage advocacy; troubleshoot.", assets:[],
        notes:"Purpose: surface barriers & commitments." } },

    { id:"p2_e3", lane:"phase2", x:1280, type:"email",
      title:"Add TuaPay to Your Website", sub:"Email • +5 days",
      details:{ day:"+5", trigger:"Phase 2 cadence", audience:"Marketing contact",
        summary:"How to list TuaPay on their website.", assets:pl(['Logo files','HTML snippet']),
        notes:"" } },

    { id:"p2_e4", lane:"phase2", x:1600, type:"email",
      title:"Share Your Success", sub:"Email • +5 days",
      details:{ day:"+5", trigger:"Phase 2 cadence", audience:"Primary contact",
        summary:"Request Google review & testimonial; co‑marketing.", assets:pl(['Review link','Testimonial form']),
        notes:"CS: Follow up for testimonial." } },

    { id:"p2_e5", lane:"phase2", x:1920, type:"email",
      title:"Become a TuaPay Star", sub:"Email • +5 days",
      details:{ day:"+5", trigger:"Phase 2 cadence", audience:"Primary contact",
        summary:"Recap actions; invite to referral program.", assets:pl(['Referral program']),
        notes:"CS: Review usage → branch." } },

    { id:"p2_decision1", lane:"phase2", x:2240, type:"decision",
      title:"Decision: Usage threshold met?", sub:"Branch to High/Low",
      details:{ day:"—", trigger:"Meets usage & advocacy criteria (TBD)?", audience:"—",
        summary:"Yes → High Usage; No → Low Usage.", assets:[], notes:"Threshold TBD." } },

    // -------------- HIGH USAGE --------------
    { id:"hi_monthly", lane:"high", x:320, type:"email",
      title:"Monthly Touch Base Email", sub:"Monthly",
      details:{ day:"Monthly", trigger:"High usage ongoing", audience:"Primary contact",
        summary:"Recognition, light tips, refreshers.", assets:pl(['(Varies monthly)']),
        notes:"—" } },

    { id:"hi_quarterly", lane:"high", x:640, type:"email",
      title:"Quarterly Beta/Case Study Invite", sub:"Quarterly",
      details:{ day:"Quarterly", trigger:"High usage ongoing", audience:"Primary contact",
        summary:"Invite to beta features or case studies.", assets:pl(['Beta sign‑up','Case study form']),
        notes:"CS: Two calls/year for relationship." } },

    // --------------- LOW USAGE ---------------
    { id:"lo_e1", lane:"low", x:320, type:"email",
      title:"We Miss You at TuaPay", sub:"Email • Day 0",
      details:{ day:"Day 0", trigger:"Low usage ongoing", audience:"Primary contact",
        summary:"Benefits refresher; prompt next loan; offer help.", assets:pl(['Coach booking','Test transaction guide']),
        notes:"CS: Call if unopened." } },

    { id:"lo_e2", lane:"low", x:640, type:"email",
      title:"Get Back in the Game (Incentive)", sub:"Email • +7 days",
      details:{ day:"+7", trigger:"Low usage ongoing", audience:"Primary contact",
        summary:"Incentive for next loan; ease & value.", assets:pl(['Incentive details']),
        notes:"" } },

    { id:"lo_call", lane:"low", x:960, type:"call",
      title:"MS Call – Barrier Check", sub:"Call • +7 days",
      details:{ day:"+7", trigger:"Low usage ongoing", audience:"Primary contact",
        summary:"Find obstacles; offer training/solutions; prompt action.", assets:[],
        notes:"Purpose: diagnose & next step." } },

    { id:"lo_e3", lane:"low", x:1280, type:"email",
      title:"Success Story Spotlight", sub:"Email • +7 days",
      details:{ day:"+7", trigger:"Low usage ongoing", audience:"Primary contact",
        summary:"Share similar merchant win as motivation.", assets:pl(['Case study PDF']),
        notes:"" } },

    { id:"lo_e4", lane:"low", x:1600, type:"email",
      title:"Quick Tips for Approvals", sub:"Email • +7 days",
      details:{ day:"+7", trigger:"Low usage ongoing", audience:"Primary contact",
        summary:"Short approval/conversion tips.", assets:pl(['Approval tips PDF']),
        notes:"" } },

    // --------------- NEW STAFF ---------------
    { id:"ns_e1", lane:"newstaff", x:320, type:"email",
      title:"Welcome to TuaPay (New Staff)", sub:"Email • Day 0",
      details:{ day:"Day 0", trigger:"Added to New Staff list", audience:"New staff contact",
        summary:"Explain training sequence and how to start fast.", assets:pl(['Portal login','Quick Start guide','Heidi’s contact']),
        notes:"CS: Personalize welcome." } },

    { id:"ns_to_phase1", lane:"newstaff", x:640, type:"decision",
      title:"Enter Phase 1 at Email 2", sub:"+3 days",
      details:{ day:"+3", trigger:"Phase 1 cadence", audience:"New staff contact",
        summary:"Continue with “Your Portal & Pre‑Qual Link”, then full Phase 1.", assets:pl(['Phase 1 assets']),
        notes:"Optional MS call after Email 2." } },
  ],
  edges: [
    // Phase 1 chain
    ["p1_start","p1_e1"],["p1_e1","p1_e2"],["p1_e2","p1_e3"],["p1_e3","p1_call1"],
    ["p1_call1","p1_e4"],["p1_e4","p1_e5"],["p1_e5","p1_e6"],["p1_e6","p1_call2"],["p1_call2","p1_decision1"],
    // Branch to Phase 2 on success
    ["p1_decision1","p2_e1"],
    // Phase 2 chain
    ["p2_e1","p2_e2"],["p2_e2","p2_call1"],["p2_call1","p2_e3"],["p2_e3","p2_e4"],["p2_e4","p2_e5"],["p2_e5","p2_decision1"],
    // Phase 2 decision to High/Low
    ["p2_decision1","hi_monthly"],["p2_decision1","lo_e1"],
    // High usage
    ["hi_monthly","hi_quarterly"],
    // Low usage
    ["lo_e1","lo_e2"],["lo_e2","lo_call"],["lo_call","lo_e3"],["lo_e3","lo_e4"],
    // New staff path
    ["ns_e1","ns_to_phase1"],["ns_to_phase1","p1_e2"]
  ]
};

/* ======= RENDERING ======= */
const svg = document.getElementById('flow');
const gLanes = document.getElementById('lanes');
const gNodes = document.getElementById('nodes');
const gEdges = document.getElementById('connectors');

const LANE_W = 4200;  // wide canvas; auto expands below if needed
const LANE_H = 120;

// Draw lanes
DATA.lanes.forEach(l => {
  gLanes.appendChild(el('rect',{ x:10, y:l.y-40, width:LANE_W, height:LANE_H, rx:12, ry:12, fill:'#fff', stroke:'#e7eef7' }));
  const title = el('text',{ x:24, y:l.y-52, class:'lane-title' });
  title.textContent = l.title;
  gLanes.appendChild(title);

  // Anchor for hash links
  const a = document.createElementNS('http://www.w3.org/2000/svg','a');
  a.setAttribute('id', l.id);
  a.setAttribute('href', `#${l.id}`);
  a.appendChild(el('rect',{x:0,y:l.y-60,width:1,height:1,fill:'transparent'}));
  gLanes.appendChild(a);
});

const laneY = Object.fromEntries(DATA.lanes.map(l => [l.id, l.y]));

const NODE_W = 260, NODE_H = 64;
const nodeById = {};
DATA.nodes.forEach(n => {
  const group = el('g',{ transform:`translate(${n.x},${laneY[n.lane]})`, cursor:'pointer' });
  if(n.type==='decision'){
    // diamond
    const size = NODE_H*0.78;
    const cx = NODE_W/2, cy = NODE_H/2;
    group.appendChild(el('rect',{
      x:cx-size/2, y:cy-size/2, width:size, height:size,
      transform:`rotate(45 ${cx} ${cy})`,
      fill:'var(--decision-fill)', stroke:'var(--decision-border)', 'stroke-width':2, rx:10, ry:10
    }));
  }else{
    // rounded rect
    let fill = "#fff", stroke = "#ccc";
    if(n.type==='call'){ fill='var(--call-fill)'; stroke='var(--call-border)'; }
    if(n.type==='email'){ stroke = emailAccents[n.lane] || "#bbb"; }
    group.appendChild(el('rect',{ x:0, y:0, width:NODE_W, height:NODE_H, rx:10, ry:10, fill:fill, stroke:stroke, 'stroke-width':2 }));

    // email accent stripe
    if(n.type==='email'){
      group.appendChild(el('rect',{ x:0, y:0, width:6, height:NODE_H, fill:emailAccents[n.lane] || "#bbb" }));
    }
  }
  // labels
  const t1 = el('text',{ x:18, y:24, class:'node-title' }); t1.textContent = n.title;
  const t2 = el('text',{ x:18, y:44, class:'node-sub' }); t2.textContent = n.sub ?? '';
  group.appendChild(t1); group.appendChild(t2);

  group.addEventListener('click', () => openModal(n));

  gNodes.appendChild(group);
  nodeById[n.id] = { x:n.x, y:laneY[n.lane], w:NODE_W, h:NODE_H };
});

// Connectors (elbow style)
DATA.edges.forEach(([a,b])=>{
  const A = nodeById[a], B = nodeById[b];
  if(!A || !B) return;
  const x1 = A.x + A.w, y1 = A.y + A.h/2;
  const x2 = B.x,       y2 = B.y + B.h/2;
  const mid = (x1 + x2)/2;
  const d = `M ${x1} ${y1} L ${mid} ${y1} L ${mid} ${y2} L ${x2} ${y2}`;
  gEdges.appendChild(el('path',{ d, stroke:'#98a9bc', 'stroke-width':2, fill:'none', 'marker-end':'url(#arrow)' }));
});

// Utility
function el(tag, attrs={}){ const e=document.createElementNS('http://www.w3.org/2000/svg',tag); for(const [k,v] of Object.entries(attrs)) e.setAttribute(k,v); return e; }

// Modal handling
const modal = document.getElementById('modal');
const closeBtn = document.getElementById('closeBtn');
function openModal(node){
  setText('m_title', node.title);
  // meta pills
  const m = document.getElementById('m_meta'); m.innerHTML = '';
  const pills = [];
  if(node.type) pills.push(node.type.toUpperCase());
  if(node.details?.day) pills.push(node.details.day);
  pills.forEach(p => { const s=document.createElement('span'); s.className='pill'; s.textContent=p; m.appendChild(s); });

  setText('m_trigger', node.details?.trigger || '—');
  setText('m_audience', node.details?.audience || '—');
  setText('m_summary', node.details?.summary || '—');

  const assets = document.getElementById('m_assets');
  assets.innerHTML = '';
  (node.details?.assets || []).forEach(a=>{
    const link = document.createElement('a');
    link.href = a.href || '#';
    link.textContent = a.label || a;
    link.addEventListener('click', e => e.preventDefault());
    assets.appendChild(link);
  });

  setText('m_notes', node.details?.notes || '');

  modal.classList.add('show');
  modal.setAttribute('aria-hidden','false');
}
function setText(id, txt){ document.getElementById(id).textContent = txt; }
function closeModal(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }
closeBtn.addEventListener('click', closeModal);
modal.addEventListener('click', e=>{ if(e.target===modal) closeModal(); });
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });

// Auto expand width if needed
(function autoWidth(){
  let maxX = 0;
  for(const n of Object.values(nodeById)) maxX = Math.max(maxX, n.x + n.w);
  const pad = 140;
  const needed = maxX + pad;
  const current = parseInt(svg.getAttribute('width'),10);
  if(needed > current){
    svg.setAttribute('width', needed);
    svg.setAttribute('viewBox', `0 0 ${needed} 920`);
  }
})();

/* helper for quick placeholder links */
function pl(labels){ return labels.map(t=>({label:t, href:'#'})); }
</script>
</body>
</html>
